# ğŸ”„ å½’ä¸€åŒ–åˆå¹¶åŠŸèƒ½è¯´æ˜

## âŒ ä¹‹å‰çš„é—®é¢˜

### é‡å¤å¡ç‰‡é—®é¢˜

åŒä¸€ä¸ªæ¦‚å¿µè¢«æ‹†æˆå¤šä¸ªå¡ç‰‡æ˜¾ç¤ºï¼š

```
ğŸ“„ èµ„æºåŸºç¡€è§‚ (Resource-Based View)
   å†å²è¯æ®: æ¡ˆä¾‹1, æ¡ˆä¾‹2

ğŸ“„ èµ„æºåŸºç¡€ç†è®º (Resource-Based View)
   å†å²è¯æ®: æ¡ˆä¾‹3

ğŸ“„ èµ„æºåŸºç¡€è§‚ (RBV)
   å†å²è¯æ®: æ¡ˆä¾‹4, æ¡ˆä¾‹5

ğŸ“„ èµ„æºåŸºç¡€ç†è®º
   å†å²è¯æ®: æ¡ˆä¾‹6
```

**é—®é¢˜**ï¼š
- âŒ ç”¨æˆ·çœ‹åˆ° 4 å¼ å¡ç‰‡ï¼Œå®é™…åªæœ‰ 1 ä¸ªæ¦‚å¿µ
- âŒ è¯æ®åˆ†æ•£ï¼Œæ— æ³•çœ‹åˆ°å®Œæ•´çš„å†å²æ¥æº
- âŒ é‡å¤ç‡è™šé«˜ï¼ˆ4ä¸ª vs å®é™…1ä¸ªï¼‰

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–°å¢å½’ä¸€åŒ–åˆå¹¶ç¯èŠ‚

```
æå– â†’ åŒ¹é… â†’ **å½’ä¸€åŒ–åˆå¹¶ï¼ˆNEWï¼‰** â†’ ç”ŸæˆæŠ¥å‘Š
```

ä½¿ç”¨ **Gemini 2.0 Flash Exp** æ™ºèƒ½è¯†åˆ«å¹¶åˆå¹¶åŒä¸€æ¦‚å¿µçš„ä¸åŒè¡¨è¿°ã€‚

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### æµç¨‹å›¾

```
åŒ¹é…ç»“æœ
   â”œâ”€ èµ„æºåŸºç¡€è§‚ (matched_terms: [...], evidence: [æ¡ˆä¾‹1, æ¡ˆä¾‹2])
   â”œâ”€ èµ„æºåŸºç¡€ç†è®º (matched_terms: [...], evidence: [æ¡ˆä¾‹3])
   â”œâ”€ èµ„æºåŸºç¡€è§‚ (RBV) (matched_terms: [...], evidence: [æ¡ˆä¾‹4, æ¡ˆä¾‹5])
   â””â”€ èµ„æºåŸºç¡€ç†è®º (matched_terms: [...], evidence: [æ¡ˆä¾‹6])
         â†“
   **å½’ä¸€åŒ–åˆå¹¶ï¼ˆGemini 2.0 Flash Expï¼‰**
         â†“
åˆå¹¶åç»“æœ
   â””â”€ èµ„æºåŸºç¡€ç†è®º (Resource-Based View)
      â”œâ”€ matched_terms: ["èµ„æºåŸºç¡€è§‚", "èµ„æºåŸºç¡€ç†è®º", "RBV", ...]
      â””â”€ evidence: [æ¡ˆä¾‹1, æ¡ˆä¾‹2, æ¡ˆä¾‹3, æ¡ˆä¾‹4, æ¡ˆä¾‹5, æ¡ˆä¾‹6]
```

---

### æ ¸å¿ƒå‡½æ•°ï¼š`consolidate_results`

**ä½ç½®**ï¼š`server.py:439-598`

**åŠŸèƒ½**ï¼š
1. åˆ†ææ‰€æœ‰åŒ¹é…ç»“æœ
2. è¯†åˆ«åŒä¸€æ¦‚å¿µçš„ä¸åŒè¡¨è¿°
3. é€‰æ‹©æ ‡å‡†åç§°ï¼ˆä¼˜å…ˆä¸­æ–‡å…¨ç§° + è‹±æ–‡æ³¨é‡Šï¼‰
4. åˆå¹¶æ‰€æœ‰å˜ä½“çš„ matched_terms
5. åˆå¹¶æ‰€æœ‰è¯æ®é“¾ï¼ˆå»é‡ï¼‰
6. åˆå¹¶ä¸Šä¸‹æ–‡

---

### AI Prompt è®¾è®¡

```python
prompt = """
ä½ æ˜¯ä¸€ä¸ªæ¦‚å¿µå½’ä¸€åŒ–ä¸“å®¶ã€‚è¯·å°†ä»¥ä¸‹ç†è®ºåˆ—è¡¨ä¸­**è¡¨ç¤ºåŒä¸€æ¦‚å¿µçš„ä¸åŒè¡¨è¿°**åˆå¹¶æˆç»Ÿä¸€æ¡ç›®ã€‚

è¾“å…¥æ•°æ®ï¼š
[
  {"db_term": "èµ„æºåŸºç¡€è§‚", "matched_terms": [...], "evidence_count": 2},
  {"db_term": "èµ„æºåŸºç¡€ç†è®º", "matched_terms": [...], "evidence_count": 1},
  {"db_term": "èµ„æºåŸºç¡€è§‚ (RBV)", "matched_terms": [...], "evidence_count": 2}
]

ä»»åŠ¡ï¼š
1. è¯†åˆ«å“ªäº›æœ¯è¯­è¡¨ç¤ºåŒä¸€ä¸ªæ¦‚å¿µ
2. é€‰æ‹©æ ‡å‡†åç§°ï¼ˆä¼˜å…ˆï¼šä¸­æ–‡å…¨ç§° + è‹±æ–‡æ³¨é‡Šï¼‰
3. åˆå¹¶æ‰€æœ‰å˜ä½“

è¾“å‡ºæ ¼å¼ï¼š
[
  {
    "standard_term": "èµ„æºåŸºç¡€ç†è®º (Resource-Based View)",
    "variants": ["èµ„æºåŸºç¡€è§‚", "èµ„æºåŸºç¡€ç†è®º", "RBV", "èµ„æºåŸºç¡€è§‚ (RBV)"],
    "match_level": "high"
  }
]

è§„åˆ™ï¼š
1. åªåˆå¹¶å®Œå…¨ç›¸åŒçš„æ¦‚å¿µï¼ˆSWOT â‰  PESTï¼‰
2. ä¼˜å…ˆä¸­æ–‡å…¨ç§° + è‹±æ–‡æ³¨é‡Š
3. match_level ä½¿ç”¨æœ€ä¸¥æ ¼çš„ç­‰çº§
"""
```

---

### åˆå¹¶é€»è¾‘

#### 1. è¯†åˆ«åŒä¸€æ¦‚å¿µ
```python
# Gemini åˆ†æè¿”å›
consolidation_map = [
  {
    "standard_term": "èµ„æºåŸºç¡€ç†è®º (Resource-Based View)",
    "variants": ["èµ„æºåŸºç¡€è§‚", "èµ„æºåŸºç¡€ç†è®º", "RBV"]
  }
]
```

#### 2. åˆå¹¶ matched_terms
```python
merged_matched_terms = []
for r in related_results:
    merged_matched_terms.extend(r.get('matched_terms', []))

# å»é‡
merged_matched_terms = list(set(merged_matched_terms))
```

#### 3. åˆå¹¶è¯æ®é“¾
```python
all_evidence = []
for r in related_results:
    all_evidence.extend(r.get('evidence', []))

# å»é‡ï¼ˆæŒ‰ filename + yearï¼‰
unique_evidence = []
seen = set()
for ev in all_evidence:
    key = (ev['filename'], ev['year'])
    if key not in seen:
        unique_evidence.append(ev)
        seen.add(key)
```

#### 4. åˆå¹¶ä¸Šä¸‹æ–‡
```python
merged_contexts = []
for r in related_results:
    if r.get('new_context'):
        merged_contexts.append(r['new_context'])

# å–å‰3ä¸ª
merged_context = " ...\n".join(merged_contexts[:3])
```

---

## ğŸ“Š æ•ˆæœå¯¹æ¯”

### ä¿®æ”¹å‰

```
ç†è®ºæŸ¥é‡ç»“æœï¼ˆ4ä¸ªï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”´ èµ„æºåŸºç¡€è§‚                      â”‚
â”‚ å†å²è¯æ®: 2 å¤„                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”´ èµ„æºåŸºç¡€ç†è®º                    â”‚
â”‚ å†å²è¯æ®: 1 å¤„                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”´ èµ„æºåŸºç¡€è§‚ (RBV)                â”‚
â”‚ å†å²è¯æ®: 2 å¤„                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”´ èµ„æºåŸºç¡€ç†è®º                    â”‚
â”‚ å†å²è¯æ®: 1 å¤„                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é—®é¢˜**ï¼š
- ç”¨æˆ·çœ‹åˆ° 4 å¼ å¡ç‰‡
- è¯æ®åˆ†æ•£åœ¨ 4 ä¸ªåœ°æ–¹
- æ— æ³•ç›´è§‚çœ‹åˆ°å®Œæ•´çš„å†å²æ¥æº

---

### ä¿®æ”¹å

```
ç†è®ºæŸ¥é‡ç»“æœï¼ˆ1ä¸ªï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”´ èµ„æºåŸºç¡€ç†è®º (Resource-Based View)     â”‚
â”‚ æ–‡ä¸­æ¶‰åŠå˜ä½“: èµ„æºåŸºç¡€è§‚, èµ„æºåŸºç¡€ç†è®º,    â”‚
â”‚              RBV, èµ„æºåŸºç¡€è§‚ (RBV)        â”‚
â”‚ å†å²è¯æ®: 6 å¤„                             â”‚
â”‚   - æ¡ˆä¾‹1 (2023)                           â”‚
â”‚   - æ¡ˆä¾‹2 (2023)                           â”‚
â”‚   - æ¡ˆä¾‹3 (2025)                           â”‚
â”‚   - æ¡ˆä¾‹4 (2025)                           â”‚
â”‚   - æ¡ˆä¾‹5 (2021)                           â”‚
â”‚   - æ¡ˆä¾‹6 (2021)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿**ï¼š
- âœ… åªæ˜¾ç¤º 1 å¼ å¡ç‰‡ï¼ˆåŒä¸€æ¦‚å¿µï¼‰
- âœ… è¯æ®å®Œæ•´èšåˆï¼ˆ6 å¤„ï¼‰
- âœ… å˜ä½“æ¸…æ™°åˆ—å‡º
- âœ… é‡å¤ç‡å‡†ç¡®

---

## ğŸ¯ å½’ä¸€åŒ–è§„åˆ™

### æ ‡å‡†åç§°é€‰æ‹©

**ä¼˜å…ˆçº§**ï¼š
1. **ä¸­æ–‡å…¨ç§° + è‹±æ–‡æ³¨é‡Š**
   - `èµ„æºåŸºç¡€ç†è®º (Resource-Based View)` âœ…
   - `RBV` âŒï¼ˆå¤ªç®€çŸ­ï¼‰

2. **å­¦æœ¯æœ¯è¯­ > ä¿—ç§°**
   - `æ³¢ç‰¹äº”åŠ›æ¨¡å‹` âœ…
   - `äº”åŠ›åˆ†æ` âŒï¼ˆä¸å®Œæ•´ï¼‰

3. **å®Œæ•´è¡¨è¿° > ç¼©å†™**
   - `SWOTåˆ†æ` âœ…
   - `SWOT` âŒï¼ˆç¼©å†™ï¼‰

---

### åˆå¹¶æ¡ä»¶

âœ… **åº”è¯¥åˆå¹¶**ï¼š
```
èµ„æºåŸºç¡€è§‚ + èµ„æºåŸºç¡€ç†è®º + RBV â†’ èµ„æºåŸºç¡€ç†è®º (Resource-Based View)
æ³¢ç‰¹äº”åŠ› + äº”åŠ›æ¨¡å‹ + Porter's Five Forces â†’ æ³¢ç‰¹äº”åŠ›æ¨¡å‹
SWOT + SWOTåˆ†æ + SWOTåˆ†ææ³• â†’ SWOTåˆ†æ
```

âŒ **ä¸åº”è¯¥åˆå¹¶**ï¼š
```
SWOT â‰  PESTï¼ˆä¸åŒç†è®ºï¼‰
4P â‰  7Pï¼ˆä¸åŒç†è®ºï¼Œ7Pæ˜¯æ‰©å±•ï¼‰
ä»·å€¼é“¾ â‰  ä¾›åº”é“¾ï¼ˆä¸åŒæ¦‚å¿µï¼‰
```

---

## ğŸ“ˆ æ•°æ®æµç¤ºä¾‹

### è¾“å…¥ï¼ˆåŒ¹é…ç»“æœï¼‰

```json
[
  {
    "db_term": "èµ„æºåŸºç¡€è§‚",
    "matched_terms": ["èµ„æºåŸºç¡€è§‚", "RBV"],
    "evidence": [{"filename": "æ¡ˆä¾‹1", "year": "2023"}, ...]
  },
  {
    "db_term": "èµ„æºåŸºç¡€ç†è®º",
    "matched_terms": ["èµ„æºåŸºç¡€ç†è®º"],
    "evidence": [{"filename": "æ¡ˆä¾‹3", "year": "2025"}]
  },
  {
    "db_term": "èµ„æºåŸºç¡€è§‚ (RBV)",
    "matched_terms": ["èµ„æºåŸºç¡€è§‚"],
    "evidence": [{"filename": "æ¡ˆä¾‹4", "year": "2025"}, ...]
  }
]
```

---

### Gemini åˆ†æè¾“å‡º

```json
[
  {
    "standard_term": "èµ„æºåŸºç¡€ç†è®º (Resource-Based View)",
    "variants": ["èµ„æºåŸºç¡€è§‚", "èµ„æºåŸºç¡€ç†è®º", "èµ„æºåŸºç¡€è§‚ (RBV)"],
    "match_level": "high"
  }
]
```

---

### æœ€ç»ˆè¾“å‡ºï¼ˆåˆå¹¶åï¼‰

```json
[
  {
    "db_term": "èµ„æºåŸºç¡€ç†è®º (Resource-Based View)",
    "matched_terms": ["èµ„æºåŸºç¡€è§‚", "RBV", "èµ„æºåŸºç¡€ç†è®º"],
    "evidence": [
      {"filename": "æ¡ˆä¾‹1", "year": "2023"},
      {"filename": "æ¡ˆä¾‹2", "year": "2023"},
      {"filename": "æ¡ˆä¾‹3", "year": "2025"},
      {"filename": "æ¡ˆä¾‹4", "year": "2025"},
      {"filename": "æ¡ˆä¾‹5", "year": "2021"},
      {"filename": "æ¡ˆä¾‹6", "year": "2021"}
    ],
    "match_level": "high",
    "risk_level": "é«˜åº¦é‡åˆ"
  }
]
```

---

## ğŸ”§ é›†æˆä½ç½®

### WebSocket æµç¨‹æ›´æ–°

**ä½ç½®**ï¼š`server.py:716-733`

```python
# æ­¥éª¤ 5: èšåˆæŠ¥å‘Š (90%)
theory_results = build_aggregated_report(...)
point_results = build_aggregated_report(...)

# æ–°å¢æ­¥éª¤ 6: å½’ä¸€åŒ–åˆå¹¶ (95%)
await websocket.send_json({
    "step": "consolidate",
    "message": "æ­£åœ¨å½’ä¸€åŒ–åˆå¹¶ç›¸åŒæ¦‚å¿µï¼ˆä½¿ç”¨ Gemini 2.5 Proï¼‰...",
    "progress": 95
})

theory_results = await consolidate_results(theory_results, 'ç†è®º')
point_results = await consolidate_results(point_results, 'çŸ¥è¯†ç‚¹')
```

---

## âš™ï¸ æ€§èƒ½è€ƒè™‘

### è€—æ—¶

- **ç†è®ºåˆå¹¶**ï¼š~5-10 ç§’ï¼ˆé€šå¸¸ < 10 ä¸ªç»“æœï¼‰
- **çŸ¥è¯†ç‚¹åˆå¹¶**ï¼š~10-20 ç§’ï¼ˆé€šå¸¸ 20-50 ä¸ªç»“æœï¼‰

### å®¹é”™

å¦‚æœåˆå¹¶å¤±è´¥ï¼ˆAPI é”™è¯¯ã€JSON è§£æå¤±è´¥ï¼‰ï¼š
```python
except Exception as e:
    logger.error(f"Consolidation failed: {e}")
    logger.warning("Skipping consolidation, using original results")
    return results  # è¿”å›åŸå§‹ç»“æœï¼Œä¸å½±å“æµç¨‹
```

---

## âœ… ä¼˜åŠ¿æ€»ç»“

| æ–¹é¢ | ä¿®æ”¹å‰ | ä¿®æ”¹å |
|------|--------|--------|
| æ˜¾ç¤ºå¡ç‰‡æ•° | 4 å¼ ï¼ˆé‡å¤ï¼‰ | 1 å¼ ï¼ˆåˆå¹¶ï¼‰ |
| è¯æ®å®Œæ•´æ€§ | åˆ†æ•£ | èšåˆ |
| ç”¨æˆ·ä½“éªŒ | æ··ä¹± | æ¸…æ™° |
| é‡å¤ç‡å‡†ç¡®æ€§ | è™šé«˜ | å‡†ç¡® |
| å†å²æ¥æº | ä¸å®Œæ•´ | å®Œæ•´ |

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### æµ‹è¯•åœºæ™¯

ä¸Šä¼ ä¸€ä¸ªåŒ…å«"èµ„æºåŸºç¡€ç†è®º"ç›¸å…³è¡¨è¿°çš„æ¡ˆä¾‹ï¼š
- æ–‡ä¸­å‡ºç°ï¼š"èµ„æºåŸºç¡€è§‚"ã€"RBV"ã€"èµ„æºåŸºç¡€ç†è®º"

### é¢„æœŸç»“æœ

âœ… **åˆå¹¶å‰**ï¼ˆ90% è¿›åº¦ï¼‰ï¼š
- å¯èƒ½æœ‰ 3-4 ä¸ªåŒ¹é…ç»“æœï¼ˆèµ„æºåŸºç¡€è§‚ã€èµ„æºåŸºç¡€ç†è®ºç­‰ï¼‰

âœ… **åˆå¹¶å**ï¼ˆ95% è¿›åº¦ï¼‰ï¼š
- åªæœ‰ 1 ä¸ªç»“æœï¼š`èµ„æºåŸºç¡€ç†è®º (Resource-Based View)`
- matched_terms åŒ…å«æ‰€æœ‰å˜ä½“
- evidence åŒ…å«æ‰€æœ‰å†å²æ¥æºï¼ˆå»é‡åï¼‰

---

âœ… **å½’ä¸€åŒ–åˆå¹¶åŠŸèƒ½å®Œæˆï¼** ğŸ‰

ç°åœ¨é‡å¯æœåŠ¡å™¨æµ‹è¯•ï¼Œåº”è¯¥èƒ½çœ‹åˆ°ï¼š
1. è¿›åº¦æ¡æ–°å¢ 95% é˜¶æ®µï¼š"æ­£åœ¨å½’ä¸€åŒ–åˆå¹¶ç›¸åŒæ¦‚å¿µ..."
2. æœ€ç»ˆæŠ¥å‘Šä¸­ï¼ŒåŒä¸€æ¦‚å¿µåªæ˜¾ç¤º 1 å¼ å¡ç‰‡
3. æ‰€æœ‰å˜ä½“å’Œè¯æ®å®Œæ•´èšåˆ
